(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[787],{5991:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/popup",function(){return o(1096)}])},1096:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return n}});var r=o(2322),s=o(2784);function n(){let[e,t]=(0,s.useState)(""),[o,n]=(0,s.useState)(""),[l,i]=(0,s.useState)(""),[a,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1);(0,s.useEffect)(()=>{chrome.storage.sync.get(["openrouterKey","flomoApiUrl"],e=>{c(!!e.openrouterKey&&!!e.flomoApiUrl)}),chrome.tabs.query({active:!0,currentWindow:!0},e=>{var r;e[0]&&(n(e[0].url||""),i(e[0].title||""),console.log("Popup: Got page info from tabs API - URL:",o,"Title:",l)),(null===(r=e[0])||void 0===r?void 0:r.id)&&chrome.tabs.sendMessage(e[0].id,{action:"getCurrentSelection"},e=>{(null==e?void 0:e.text)&&t(e.text)})})},[]);let d=()=>{chrome.runtime.openOptionsPage()};return(0,r.jsxs)("div",{className:"extension-popup p-4 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Flomo AI 笔记"}),(0,r.jsx)("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800",children:"设置"})]}),a?(0,r.jsxs)("div",{children:[e?(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"选中的文本："}),(0,r.jsx)("div",{className:"bg-gray-100 p-3 rounded text-sm max-h-32 overflow-y-auto",children:e})]}):(0,r.jsx)("p",{className:"text-gray-600 mb-4 text-sm",children:"请在网页中选择一些文本，然后点击总结按钮"}),(0,r.jsx)("button",{onClick:()=>{if(!e.trim()){alert("请先选择一些文本");return}m(!0),chrome.storage.sync.get(["openrouterKey","flomoApiUrl","serverUrl"],async t=>{try{let r=t.serverUrl||"http://localhost:3001",s=await fetch("".concat(r,"/api/summarize-to-flomo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,openrouterKey:t.openrouterKey,flomoApiUrl:t.flomoApiUrl,sourceUrl:o,pageTitle:l})}),n=await s.json();if(console.log("test1111",n),s.ok)alert("笔记已成功保存到Flomo！"),window.close();else throw Error(n.error||"处理失败")}catch(e){console.error("Error:",e),alert("错误: ".concat(e.message))}finally{m(!1)}})},disabled:!e.trim()||u,className:"w-full py-2 px-4 rounded transition-colors mb-2 ".concat(e.trim()&&!u?"bg-green-500 text-white hover:bg-green-600":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:u?"正在总结...":"总结到Flomo"}),(0,r.jsx)("button",{onClick:()=>{chrome.runtime.sendMessage({action:"testNotification"},e=>{(null==e?void 0:e.success)?console.log("Popup: Test notification sent successfully"):(console.log("Popup: Test notification failed"),alert("通知测试失败，请检查浏览器通知权限"))})},className:"w-full py-2 px-4 rounded bg-blue-500 text-white hover:bg-blue-600 transition-colors text-sm",children:"测试通知"})]}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"请先配置您的API密钥"}),(0,r.jsx)("button",{onClick:d,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",children:"去设置"})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5991)}),_N_E=e.O()}]);